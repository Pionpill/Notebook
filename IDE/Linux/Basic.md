<link rel=stylesheet href=style.css>

# Linux 基础
> 这是学习 `The Linux Command` 的笔记  
> Linux 环境为 Ubuntu 20   

## 1 Linux 基础指令
### 1.1 基础指令与操作
#### 常用指令
- `$ data`：返回当前时间和日期
- `$ cal`：显示当前月份
- `$ df`：查看磁盘可用空间
- `$ free`：查看可用内存容量
- `$ exit`：退出终端
#### GUI 操作
- 复制粘贴
  - 复制：双击终端文件名
  - 粘贴：鼠标中键

### 1.2 导航
#### Linux 文件树 
- Linux 目录结构
  ```json
    ├── /: 根目录
    |   ├── /bin: 可执行的二进制文件目录
    |   ├── /boot: 放置 Linux 系统启动时用到的一些文件
    |   ├── /dev: 存放 Linux 系统下的设备文件
    |   ├── /etc: 系统配置文件放的目录
    |   ├── /home: 系统默认的用户家目录
    |   ├── /lib: 系统使用的函数库的目录
    |   ├── /lost+found: 文件系统损坏时的部分恢复 
    |   ├── /media: 可移动设备，如 USB 端口
    |   ├── /mnt: 手动挂载的各种可移动存储设备 
    |   ├── /opt: 安装"可选" 软件
    |   ├── /proc: 虚拟文件，可通过其中文件了解内核管理计算机
    |   ├── /root: 超级用户主目录
    |   ├── /sbin: 执行重要系统任务
    |   ├── /tmp: 临时文件
    |   ├── /user: 用户用到的所有程序和支持文件
    |   |   ├── /bin: Linux 发行版安装的程序
    |   |   ├── /lib: /user/bin 中程序用到的共享库
    |   |   ├── /local: 超级用户添加的内容
    |   |   ├── /sbin: 更多系统管理工具
    |   |   ├── /share: /user/bin 中程序用到的共享数据
    |   |   |   └── /doc: 系统安装的软件包自带的文档
    |   ├── /var: 动态文件文件夹
    |   |   └── /log: 日志文件
    |   ├── ......
  ```
- 两个常用的 Linux 文件数指令
  - `$ pwd`：获取当前目录
  - `$ ls`：列出当前目录下的文件
    - `$ ls` 指令允许多个路径作为参数

#### 工作目录
- 相对路径与绝对路径
  - `$ cd`：用于更改工作目录
  - 绝对路径：从根目录开始
    - 举例：`$ cd /user/bin`
  - 相对路径：从当前位置开始
    - 举例：`$ cd bin`)
    - 当前工作目录：`.`
    - 上一工作目录：`..`
- Linux 文件的特点
  - 以 . 开头的文件是隐藏的， `$ ls` 指令不会显示 `$ ls -a` 指令会显示
  - Linux 文件名区分大小写
  - Linux 文件命名规范：数字，字母，点号 `.`，半字线 `-`，下划线 `_`
- cd 命名的便捷写法
  | 写法              | 效果                                    |
  | ----------------- | --------------------------------------- |
  | `$ cd`            | 将当前目录更改为用户主目录              |
  | `$ cd -`          | 将当前工作目录切换回前一个工作目录      |
  | `$ cd ~user_name` | 将当前工作目录更改为 user_name 的主目录 |

### 1.3 详细指令参数
#### `$ ls` 指令详解 
- 选项与参数
  - 一般指令格式
    - `$ command -options arguments`
    - 短选项：`-option` 可以同时使用多个，如 `-lt`
    - 长选项：`--option` 
  - 常用 `$ ls` 指令命令选项
    | 短选项 | 长选项           | 描述                                                          |
    | ------ | ---------------- | ------------------------------------------------------------- |
    | -a     | --all            | 列出所有文件，包含隐藏文件                                    |
    | -A     | --almost-all     | 在 -a 基础上，不列出当前工作目录和父目录                      |
    | -d     | --directory      | 与 -l 结合，查看目录详细信息                                  |
    | -F     | --classify       | 在每个列出的名称后面加上类型指示符                            |
    | -h     | --human-readable | 在 -l 长格式输出结果中，不以 B 为单位，改用人类可读的文件大小 |
    | -l     |                  | 以长格式显示输出结果                                          |
    | -r     | --reverse        | 降序显示                                                      |
    | -S     |                  | 按文件大小排序输出结果                                        |
    | -t     |                  | 按修改日期排序输出结果                                        |
- 长格式
  - 示例 `$ ls -lh` 
  - 输出：`drwxr-xr-x 3 pionpill pionpill 40K 4] 7 17: 32 Desktop -> Desktop_Pionpill`
    | 字段             | 子字段 | 含义                                       |
    | ---------------- | ------ | ------------------------------------------ |
    | drwxr-xr-x       | d      | 第一个 d 表示为文件夹，若为 - 表示普通文件 |
    |                  | rwx    | 文件属主的访问权限                         |
    |                  | r-x    | 文件属组的访问权限                         |
    |                  | r-x    | 其他人的访问权限                           |
    | 3                |        | 文件硬链接数量                             |
    | pionpill         |        | 文件属主                                   |
    | pionpill         |        | 文件属组                                   |
    | 4.0K             |        | 文件大小                                   |
    | 4月 7 17:32      |        | 文件最后修改日期                           |
    | Desktop          |        | 文件名                                     |
    | Desktop_Pionpill |        | 文件真实名                                 |

#### `$ file` 指令
- Unix/Linux 系统认为任务皆文件
- `$ file` 将显示文件的基础信息

#### `$ less` 指令
- `$ less <filename>` 查看文本文件内容
- 文本文件操作
  |           命令/按键 | 效果   |   命令/按键 | 效果           |
  | ------------------: | ------ | ----------: | -------------- |
  |         Page Up / b | 后翻   |           g | 文件头         |
  | Page Down / 'space' | 前翻   | /characters | 搜索指定字符串 |
  |                 '↑' | 后一行 |           n | 重复上一次搜索 |
  |                 '↓' | 前一行 |           h | 帮助           |
  |                   G | 文件尾 |           q | 退出           |



## 2 文件操作与命令
### 2.1 操作文件和目录
#### 通配符

- 通配符及其含义
  | 通配符        | 含义                                           |
  | ------------- | ---------------------------------------------- |
  | *             | 匹配任意多个字符                               |
  | ?             | 匹配任意单个字符                               |
  | [characters]  | 匹配属于字符集合 characters 中的任意单个字符   |
  | [!characters] | 匹配不属于字符集合 characters 中的任意单个字符 |
  | [[:class:]]   | 匹配属于字符类 class 中的任意单个字符          |
- 常用的字符类
  | 字符类    | 含义                     |
  | --------- | ------------------------ |
  | [:alnum:] | 匹配任意单个字母数字字符 |
  | [:alpha:] | 匹配任意单个字母         |
  | [:digit:] | 匹配任意单个数字         |
  | [:lower:] | 匹配任意单个小写字母     |
  | [:upper:] | 匹配任意单个大写字母     |
#### 文件操作指令
- `$ mkdir` 创建目录
  - 用法：`$ mkdir directory...`
- `$ cp` 复制文件和目录
  - 将单个文件或目录复制到单个文件或目录：`$ cp item1 item2`
  - 将多个文件或目录复制到目录 directory：`$ cp item... directory`
  - 可选项
    | 短选项 | 长选项        | 含义                                 |
    | ------ | ------------- | ------------------------------------ |
    | -a     | --archive     | 复制文件和目录及其权限在内的所有属性 |
    | -i     | --interactive | 在覆盖已有文件之前，提示用户确认     |
    | -r     | --recursive   | 递归复制目录及内容                   |
    | -u     | --update      | 仅复制不存在或更新的文件             |
    | -v     | --verbose     | 在进行复制时显示相关信息             |
- `$ mv` 移动和重命名文件
  - 将单个文件或目录移动/重命名到单个文件或目录：`$ mv item1 item2`
  - 将多个文件或目录移动/重命名到目录 directory：`$ mv item... directory`
  - 可选项
    | 短选项 | 长选项        | 含义                             |
    | ------ | ------------- | -------------------------------- |
    | -i     | --interactive | 在覆盖已有文件之前，提示用户确认 |
    | -u     | --update      | 仅移动不存在或更新的文件         |
    | -v     | --verbose     | 在进行复制时显示相关信息         |
- `$ rm` 删除文件和目录
  - 用法：`$ rm item...`
  - 可选项
    | 短选项 | 长选项        | 含义                                        |
    | ------ | ------------- | ------------------------------------------- |
    | -i     | --interactive | 在删除已有文件之前，提示用户确认            |
    | -r     | --recursive   | 递归复制目录及内容                          |
    | -f     | --force       | 忽略不存在的文件，不提示。此可选项将屏蔽 -i |
    | -v     | --verbose     | 在进行删除时显示相关信息                    |
#### 硬链接与符号链接
- 硬链接
  - 默认一个文件只有一个硬链接，由其为文件赋予名称
  - 可以创建格外的硬链接，也就相当于创建了一个目录项
  - 硬链接的限制
    - 硬链接不能引用所在文件系统之外的文件，即不能引用不同磁盘的文件
    - 硬链接不能引用目录
  - 删除一个文件的一个硬链接不能删除文件，需要删除该文件的所有硬链接才行
  - 创建硬链接 `$ ln file link`
  - 相同硬链接指向同一区域
  - 可以通过 `$ ls -i` 查看第一个字段，即节点号，判定是否为同一文件的硬链接
- 符号链接
  - 符号链接旨在弥补硬链接的两个限制
  - 符号链接类似于 Windows 的快捷方式
  - 向符号链接写入的内容等同于想写入被引用的文件
  - 如果符号链接引用的文件被删除，符号链接将变成无效链接，`$ ls` 指令会用颜色告知用户(一般为红色)
  - 创建符号链接 `$ ln -s item link`

### 2.2 命令
#### 命令的定义
- 符合以下条件之一都可以成为命令
  - 可执行程序，在 `/user/bin` 中的文件，可以是可执行文件也可以是脚本
  - Shell 内建命令
  - Shell 函数
  - 别名。在其他命令基础上自定义的命令
#### 识别命令
- `$ type` 显示命令类型
  - Shell 内建命令，显示命令属于哪一类
  - 用法 `$ type <command>`
- `$ which` 显示可执行文件位置
  - 用法 `$ which <command>` 
  - 只能显示可执行文件位置，对于内建，别名无效
#### 命令帮助
- `$ help` 获取帮助信息
  - 用法 `$ help <command>`
- `$ --help` 显示用法信息
  - 用法 `$ <command> --help`
  - 显示命令所支持的语法和选项的相关描述
- `$ man` 显示命令的手册页
  - 用法 `$ man [section] <program>`
  - 大多数用于命令行的程序都会提供一份手册页
  - 手册页往往分为几节，可以通过 [section] 指定打开的节
- `$ apropos` 显示适合的命令清单
  - 用法 `$ apropos <keyword>`
  - 根据关键字在手册页列表中搜索可能的匹配项
- `$ whatis` 显示手册页的简述
  - 用法 `$ whatis <command>`
  - 显示匹配指定关键字的手册页名称和当行描述
- `$ info` 显示程序的 info 条目
  - 用法 `$ info <command>`
  - info 指令用于替代手册页，提供阅读器显示
  - info 阅读器的操作
    |  命令 | 操作               |             命令 | 操作     |
    | ----: | ------------------ | ---------------: | -------- |
    |     ? | 显示帮助信息       | PGUP / BackSpace | 上一页   |
    |     u | 显示父节点         |   PGON / 'space' | 下一页   |
    | Enter | 进入光标所在超链接 |                n | 下一节点 |
    |     q | 退出               |                p | 上一节点 |
#### 使用 alias 自定义命令
- 多个指令执行
  - `command1; command2; command3...`
- 子定义别名的步骤
  1. 使用 `$ type <command>` 指令查询指令名是否已存在
  2. 使用 `$ alias name ='string'` 创建别名
  3. 使用 `$ unalias <command>` 删除别名
- 备注
  - 使用不带参数的 `$ alias` 指令可以查询系统定义的所有别名
  - 当别名未被保存时，若 Shell 会话结束，别名也将随之消失

### 2.3 重定向
#### 标准输出重定向
- 重定向操作符 `>`
  - 用法 `$ <command> > <file>`
  - 例：`$ ls -l /user/bin > ls-out.txt`
  - 标准输出重定向即将标准输出存放到指定文件
  - 如果出现错误，则不会输出，并提示错误，这是因为标准错误不是标准输出
  - 如果使用 `$ > <file>` 指令，将截断或者创建一个新文件
- 追加文件操作符 `>>`
  - 使用 `>>` 替换 `>` 将在文件尾部添加内容
#### 标准错误重定向
- 基本概念
  - 标准错误重定向没有专门的符号
  - Shell 内部文件流表示
    - 标准输入：0
    - 标准输出：1
    - 表尊错误：2
  - 重定向表尊错误
    - 用法 `$ <command> 2> <file>`
- 将标准输出和标准错误重定向到同一个文件
  - 重定向操作的顺序
    - 标准错误重定向操作必须在标准输出重定向之后
  - 旧版 Shell 实现
    - 例 `$ ls -l /bin/user > ls-out.txt 2>&1`
    - 先标准输出重定向，再用 `2>&1` 将文件描述符2(标准错误)重定向到文件描述符1(标准输出)
  - 新版本 Shell 实现
    - 例 `$ ls -l /bin/user &> ls-out.txt `
    - 例 `$ ls -l /bin/user &>> ls-out.txt `
- 丢弃用不着的输出结果
  - 垃圾桶 `/dev/null` 接受输入结果但不做任何处理
  - 例 `$ ls -l /bin/user 2> /dev/null`

#### 标准输入重定向
- `$ cat` 指令
  - 用法 `$ cat <filename>`
  - 读取一个或多个文件并将其复制到标准输出
  - 大多数情况下，`cat` 指令和 `type` 指令等同
    - `cat` 通常用于显示比较短的文本文件。
    - `cat` 指令可以接收多个文件作为参数，所以还可用于将文件拼接在一起
    - 可以使用类使 `cat text1.txt text2.txt ... > text.txt` 将多个文件合并输出
  - 无参数 `cat` 指令
    - 将等待用户从标准输入(键盘)中读取
    - 结束键：Ctrl + D
  - 标准定向操作符 `<`
    - 通过 `<` 操作符可以将文件作为标准输入
    - 与直接读取文件相比，并没有什么差别

#### 管道
- 管道操作符 `|`
  - 用法 `command1 | command2`
  - 说明：将 command1 的标准输出传给 command2 的标准输入
  - 例如：`$ ls -l /user/bin | less`: 将文件详细信息以分页方式显示
- `sort` 排序列表 
  - `$ ls /bin /user/bin | sort | less`
  - 将多个文件目录排序并按页输出
- `uniq` 报告或忽略重复行
  - 忽略重复行：`$ ls /bin /user/bin | sort | uniq | less`
  - 报告重复行：`$ ls /bin /user/bin | sort | uniq -d | less`
- `wc` 统计换行符，单词，字节
  - 用法 `wc <filename>`
  - 显示行数，单词树，字数 `$ wc text.txt`
  - 显示行数 `$ ls /bin /user/bin | sort | uniq | wc -l`
- `grep` 输出与模式匹配的行
  - 用法 `$ grep pattern filename`
  - `grep` 指令能通过正则表达式匹配: `$ ls /bin /user/bin | sort | uniq | grep zip`
  - 两个有用的可选参数
    - `-i` 忽略大小写
    - `-v` 只输出不匹配的内容
- `head/tail` 输出开头/结尾部分
  - 用法 `$ head/tail [-n] <filename>`
  - 可以通过 `-n 5` 指定只显示 5 行
  - 例 `$ ls /user/bin | tail -n 5`
- `tee` 读取标准输入并写入标准输出文件
  - `tee` 指令类使 T 管道，将标准输入写入当前标准输出文件中，但又不影响管道中的下一指令
  - 例 `$ ls /user/bin | tee ls.txt | grep zip`

### 2.4 指令扩展
#### 扩展的概念
- Shell 在执行指令前回对一些文本进行替换操作，这一过程被称为扩展
- `$ echo` 指令：将文本参数输出到标准输出
#### 路径名扩展
- 通配符的工作机制称为路径名扩展
- `$ echo *` 将显示路径下文件名
#### 波浪线扩展
- 用于单词之前，扩展为同名用户的主目录
#### 算术扩展
- 用法 `$((expression))`
- 仅仅支持整数运算
- 允许嵌套，支持加，减，乘，除，取模，幂运算
#### 花括号扩展
- `,` ：各匹配一次
  - `$ echo Number_{1,2,3}`: Number_1,Number_2,Number_3
- `..`：范围匹配
  - `$ echo {01..03}`: 01,02,03
- 组合举例
  - `$ echo a{A{1,2},B{3,4}}b`：aA1b,aA2b,aB3b,aB4b
- 参数扩展
  - 参数扩展允许我们将数据保存在变量中
  - `$ echo $USER`
- 命令扩展
  - 命令扩展允许我们使用命令的输出结果作为扩展结果
  - 例 `$ echo $(ls)`

### 2.5 引用
#### 双引号
- 双引号中的文本将失去特殊字符含义
- 一下字符仍具有特殊含义：$ \ `
#### 单引号
- 禁止所有扩展，所有内容将失去特殊含义
#### 转义字符
- 在双引号中，可以通过 `\` 将某个特殊字符转换为无意义
- 特殊转义字符
  | 转义序列 | 含义   | 转义序列 | 含义   |
  | -------- | ------ | -------- | ------ |
  | \a       | 响铃   | \b       | 退格符 |
  | \n       | 新行   | \r       | 回车符 |
  | \t       | 制表符 |          |        |

### 2.6 键盘技巧
#### 组合键键
- 光标移动组合键
  | 组合键       | 操作                   | 组合键       | 操作                 |
  | ------------ | ---------------------- | ------------ | -------------------- |
  | Ctrl - A     | 光标移动到行首         | Ctrl - E     | 光标移动到行尾       |
  | Ctrl - F / → | 光标向后移动一个字符   | Ctrl - B / ⬅ | 光标向前移动一个字符 |
  | Alt - F      | 光标向后移动一个单词   | Alt - B      | 光标向前移动一个单词 |
  | Ctrl - L     | 清除屏幕，等同于 clear |
- 修改命令行文本的组合键
  | 组合键   | 操作                           | 组合键   | 操作                           |
  | -------- | ------------------------------ | -------- | ------------------------------ |
  | Ctrl - D | 删除光标处字符                 | Ctrl - T | 将光处字符与之前字符对调       |
  | Alt - T  | 将光处单词与之前单词对调       | Alt - L  | 将光标处到单词结尾处字符转小写 |
  | Alt - U  | 将光标处到单词结尾处字符转大写 |          |                                |
- 剪切粘贴组合键
  | 组合键   | 操作                                  | 组合键          | 操作                             |
  | -------- | ------------------------------------- | --------------- | -------------------------------- |
  | Ctrl - K | 剪切从光标处到行尾的文本              | Ctrl - U        | 剪切从光标处到行首的文本         |
  | Alt - D  | 剪切从光标处到当前单词结尾的文本      | Alt - BackSpace | 剪切从光标处到当前单词开头的文本 |
  | Ctrl - Y | 将 kill-ring 缓冲区的文本粘贴到光标处 |
#### 补全机制
- Shell 可以通过 Tab 键实现自动补全功能
- 若没有歧义，补全功能将实现，若有，则需要更精确的名称
- 补全功能相关的组合键
  | 组合键  | 操作                                            |
  | ------- | ----------------------------------------------- |
  | Alt - $ | 显示可能的补全结果，多数系统支持按两次 Tab 实现 |
  | Alt - * | 插入所有可能的补全结果                          |
#### 命令历史记录
- 搜索历史记录
  - `$ history | less` 查看历史记录的内容
  - `$ history | grep /user/bin` 找出特定目录下的历史记录
    - 若显示 `88 history ...` 中 88 表示有 88 条指令
    - 可以使用 `!num` 扩展为历史记录中第 num 行 内容
  - 增量搜索
    - 按 `Ctrl - R` 输入内容，开始匹配搜索
    - `Enter / Ctrl - J` 将匹配项从历史记录复制到当前行
    - `Ctrl - R` 查找下一个匹配项
    - `Ctrl - G / Ctrl - C` 退出搜索 
  - 历史操作组合键
    | 组合键       | 操作                         | 组合键   | 操作                                 |
    | ------------ | ---------------------------- | -------- | ------------------------------------ |
    | Ctrl - P / ↑ | 上一条历史记录               | Ctrl - R | 反向增量搜索                         |
    | Ctrl - N / ↓ | 下一条历史记录               | Alt - P  | 非增量反向搜索                       |
    | Alt - <      | 移动到历史记录列表开头(顶部) | Alt - N  | 非增量向前查找                       |
    | Alt - >      | 移动到历史记录列表结尾(底部) | Ctrl - O | 执行历史记录中命令并移动到下一条命令 |
#### 历史扩展
- 历史扩展命令
  | 序列    | 操作                           | 序列     | 操作                                 |
  | ------- | ------------------------------ | -------- | ------------------------------------ |
  | !!      | 重复上一个命令                 | !number  | 重复历史记录列表中的第 number 个命令 |
  | !string | 重复 string 开头的最后一个命令 | !?string | 重复包含 string 的最后一个命令       |

## 3 权限与进程
### 3.1 权限
#### 属主，属组以及其他用户
- 属主(uid)：用户, 定义在 `/etc/passwd` 文件中，在 `etc/shadow` 中保存了用户的密码信息
- 属组(gid)：一个或多个用户组成的组, 定义在 `/etc/group` 文件中
- 属组用户被文件和目录的属主授予访问权
- 使用 `$ id` 指令可以查看用户信息
#### 读取，写入和执行
- 