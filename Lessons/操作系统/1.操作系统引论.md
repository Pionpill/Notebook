<link rel=stylesheet href=style.css>

# **操作系统引论**

参考资料：[CSDN](https://blog.csdn.net/sinat_31710221/article/details/53056058)

## **操作系统的目标和作用**

>  操作系统的目标 

- <span class=imp>方便性，有效性，可扩充性，开放性</span>

>  操作系统的作用 

- <span class=imp>OS作为用户与计算机硬件系统之间的接口</span>
  - 使用计算机的三种方法
    - <span class=imp>命令方式</span>
    - <span class=imp>系统调用方式</span>
    - <span class=imp>图标-窗口方式</span>
- <span class=imp>OS作为计算机系统资源的管理者</span>
  - 软硬件资源管理/基本功能
    - <span class=imp>处理机</span>：分配和控制处理机
    - <span class=imp>存储器</span>：内存的分配与回收
    - <span class=imp>I/O 设备</span>：I/O 设备的分配(回收)与操作
    - <span class=imp>文件</span>：实现对文件的存取，共享和保护
- <span class=imp>OS实现了对计算机资源的抽象</span>

>  推动系统发展的动力 

- 不断提高计算机资源利用率
- 方便用户
- 器件的不断更新迭代
- 计算机体系结构的不断发展
- 不断提出新的应用要求

<br>

## **操作系统的发展过程**

>  未配置操作系统的计算机系统 

- 人工操作：
  - 单用户、CPU. 内存长期空闲
  - 缺点
    - 用户独占全机
    - 人机速度矛盾导致资源利用率极低
- 脱机输入/输出（OFF-LINE I/0）：
  - 装好卡片再上机。
  - 优点：节约 CPU 空闲时间、提高 I/O 速度

>  单道批处理系统 

- 单道批处理的处理过程
  - 有个监督程序将磁带上的作业调入计算机
- 单道批处理系统的缺点
  - I/O 太慢，CPU 太快
  - 系统中的资源得不到充分利用

>  多道批处理系统 

- 基本概念：用户所提交的作业先存放在外存，排成一个“后备队列”，再由作业调度程序按一定的算法从队列选择若干作业调入内存，使他们共享CPU和系统中的各种资源
- 描述：A 在 I/0，B 趁机 CPU
- 动力：提高资源利用率和系统吞吐量
- 优缺点
  - 资源利用率高
  - 系统吞吐量大
  - 平均周转周期长
  - 无交互能力

>  分时系统 

- 描述：在一台主机上连接了<span class=imp>多个</span>带有显示器和键盘的终端，同时允许<span class=imp>多个用户</span>通过自己的终端，以交互方式使用计算机，共享主机中的资源
- 优点：终于有人机交互、多用户共享主机
- 实际问题：由于多用户，所以要有“多路卡”、作业直接入内存、有个“时间片”调度作业
- 特征：多路、独立、及时（用户可接受）、交互

>  实时系统 

- 描述：工业（武器）控制系统、信息查询系统、多媒体系统、嵌入式系统
- 类型 1：周期性实时：真的很周期；非周期性实时：有开始截止时间和完成截止时间
- 类型 2：硬实时：工业、武器系统；软实时：信息查询系统和多媒体系统
- 与分时系统比较： 多路、独立、及时（毫秒级）、交互、可靠

>  微机时代 

- 单用户单任务：8 位机的 CP/M、16 位机的 MS-DOS
- 单用户多任务：目前的 32 位系统，如 Windows
- 多用户多任务：UNIX、Solaris、Linux

<br>

## **操作系统共同特性**

> <span class=imp>并发 </span>
- 并发和并行宏观上一样
  - 并发：单处理机系统，微观上交替运行
  - 并行：多处理机系统，微观上同时运行
- 引入进程
  - 进程：在系统中能独立运行并作为资源分配的基本单位，由机器指令、数据和堆栈等组成，能独立运行的活动实体
  - 特点：用进程就可以并发执行了
- 引入进程：提高了系统资源的利用率和系统吞吐量，并改善了系统的性能
- 引入线程：对它的调度所付出的开销比进程小得多，能更高效地提高系统内多个程序间并发执行的程度

>  <span class=imp>共享</span>
- 互斥共享方式
  - 临界资源：打印机、磁带机
  - 描述：你要先申请才能获得资源
- 同时访问方式
  - 描述：微观上还是并发
  - 例子：多用户磁盘设备
  - 条件：系统允许进程并发、系统能有效管理资源

>  <span class=imp>虚拟 </span>
- 时分复用技术
  - 描述：利用处理机的空闲时间运行其他程序，提高处理机的利用率
  - 虚拟处理机技术：分身之术
  - 虚拟设备：又是分身之术，骗用户以为有专人服务
  - 时分复用：速度：≤1/N
- 空分复用技术
  - 描述：利用存储器的空闲空间存放其他程序，提高内存的利用率
  - 空分复用：空间：≤1/N

>  <span class=imp>异步</span> 
- 进程的执行不是一贯到底的，而是走走停停，进程以不可预知的速度向前推进

## **操作系统主要功能**
>  处理机管理功能 
- 控制进程
  - 描述：要并发，就要进程、要进程，就要管理
- 进程同步
  - 进程互斥方式：临界资源要互斥
  - 进程同步方式：合作完成共同任务，同步机构要协调先后次序
- 进程通信
  - 描述：对合作进程而言，需要交换信息。当他们处于同一计算机系统时，通常采用直接通信的方式。
  - 例子：输入进程、计算进程、打印进程，需要信息交换
- 调度
  - 作业调度：选择作业、建立进程、分配资源、插入就绪队列
  - 进程调度：从就绪队列中选出进程，分配CPU

>  存储器管理功能 
- 内存分配
  - 任务：分配空间、减少碎片、追加内存空间
  - 分配方式
    - 静态分配，装入内存时确定，不允许追加、不允许移动
    - 动态分配，允许追加、允许移动
- 内存保护
  - 任务1：每道程序只在自己的内存空间运行，互不干扰
  - 任务2：不允许用户程序访问操作系统程序和数据、也不允许用户程序转移到非共享的其他用户程序中执行
- 地址映射
  - 任务：存储器要负责地址映射，在硬件支持下完成
- 内存扩充
  - 描述：用虚拟存储技术，从逻辑上扩充内存容量
  - 任务1：请求-调入功能
  - 任务2：置换功能

>  设备管理功能 
- 任务1：完成用户进程的I/O请求：分配I/O设备，完成I/O操作
- 任务2：提高CPU和I/O利用率：提高I/O速度，方便用户使用I/O设备
- 缓冲管理
  - 描述：在内存中设置缓冲区
  - 例子：单缓冲机制、双向同时传送数据的双缓冲机制、多个设备共同使用的公用“缓冲池”机制
- 设备分配
  - 描述：在系统中设置“设备控制表”、“控制器控制表”等数据结构，用于记录设备和控制器等标识符和状态。根据表就知道指定设备当前是否可用、忙碌。分配时，针对不同设备要有不同“分配方式”，对独占设备还要考虑分配后是否安全
- 设备处理
  - 描述：CPU向设备控制器发出I/O命令，要求完成I/O操作、反之，CPU接收控制器发出的中断请求，并响应.处理

>  文件管理功能 
- 描述：管理用户、系统文件，方便使用；保证安全性
- 文件储存空间管理
  - 背景：多用户环境下，用户自己管理文件存储，会困难和低效
  - 任务1：为每个文件分配外存空间、提高外存利用率、进而提高存取速度
  - 任务2：系统中设置数据结构，记录文件存储空间使用情况，以供分配时参考
  - 任务3：分配和回收
- 目录管理
  - 任务1：为每个文件建立目录项，包括文件名、属性、物理位置等，以实现按名存取
  - 任务2：实现文件共享。
  - 任务3：提供目录查询手段
- 文件读/写管理和保护
  - 文件读/写管理：根据用户请求，从外存中读取数据，或将数据写入外存
  - 文件保护：防止未经核准的用户存取文件、防止冒名顶替存取文件、防止以不正确方式使用文件

>  操作系统与用户之间的接口 
- 用户接口
  - 描述：方便用户直接.间接控制自己的作业
  - 联机用户接口：等待用户键入命令
  - 脱机用户接口：一开始就提供作业说明书，直到作业结束语句
  - 图形用户接口：移动鼠标选择菜单项
- 程序接口
  - 描述：旧系统用汇编语言写，所以只有汇编语言的才能直接使用系统调用；如果是高级语言，就用一一对应的库函数

>  现代操作系统的新功能 
- 系统安全
  - 描述：确保存储和传送数据的保密性、完整性和系统可用性，要用几种技术
  - 技术：认证技术、密码技术、访问控制技术、反病毒技术
- 网络的功能和服务
  - 功能：网络通信、资源管理、应用互操作
- 支持多媒体
  - 功能：接纳控制功能、实时调度、多媒体文件的存储

## **OS结构设计**
>  传统操作系统结构 
- 无结构操作系统
  - 又名：整体系统结构
- 模块化结构OS
  - 基本概念
    - 又名：模块-接口法
    - 描述：有模块、子模块、接口
  - 模块独立性
    - 标准：内聚性越高，模块独立性越高、耦合度越低，模块独立性越高
    - 优点：提高设计正确性.可理解性和可维护性、增强可适应性、加快加速过程
    - 缺点：接口难以满足需求、无序
- 分层式结构OS
  - 基本概念：有序分层，自底向上法铺设中间层
  - 优点：易保证系统正确性、易扩充和易维护
  - 缺点：系统效率降低

>  客户/服务器模式(Client/Server Model)简介 
- 客户/服务器模式的由来、组成和类型
  - 组成：客户机、服务器、网络系统
- 客户/服务器之间的交互
  - 描述：客户发送请求消息、服务器接收消息、服务器回送消息、客户机接收消息
- 客户/服务器模式的优点
  - 描述：数据分布处理和存储、便于集中管理、灵活性和可扩充性、易于改编应用软件

>  面向对象的程序设计  
- OOP的基本概念
  - 描述：抽象，具体事物为对象
  - 对象：封装好
  - 对象类：创建多个相似对象
  - 继承：继承父类，增加部分
- OOP的优点
  - 描述：“重用”提高产品质量和生产率、使系统具有更好的易修改性和易扩展性、易于保证系统“正确性”和“可靠性”

>  微内核OS结构 
- 描述：支持多处理机
- 例子：卡内基·梅隆的Mach OS、Windows 2000/XP
- 基本概念
  - 描述：足够小的内核、基于C/S模式、应用“机制与策略分离”原理、采用OOP技术
- 基本功能
  - 描述：进程管理、低级存储器管理、中断和陷入处理
- 优点
  - 描述：提高可扩展性、增强可靠性、可移植性强、提供对分布式系统的支持、融入OOP
- 缺点
  - 描述：效率降低

## 操作系统的运行机制与内核
> 运行机制
  - 指令：处理器(CPU)能识别、执行的最基本命令
  - 指令的分类
    - <span class=imp>特权指令</span>：不允许用户程序使用
    - <span class=imp>非特权指令</span>：用户可以使用
  - 两种处理器状态（PSW中标识符确定）：
    - <span class=imp>用户态（目态）</span>：只能执行非特权指令
    - <span class=imp>核心态（管态）</span>：特权指令，非特权指令都可以执行
  - 两种程序
    - <span class=imp>内核程序</span>：运行在核心态
    - <span class=imp>应用程序</span>：只能执行非特权指令
> 操作系统内核
  - 内核
    - 内核是计算机上配置的底层软件，是操作系统最基本、最核心的部分
    - 实现操作系统内核功能的那些程序就是内核程序
  - 层次结构  
    <img src=images/层次结构.png width=350px>
    - 大内核：将操作系统的主要功能模块都作为系统内核，运行在核心态
      - 优点：高性能
      - 缺点：内核代码庞大，结构混乱，难以维护
    - 微内核：只包最基本的功能
      - 优点：内核功能少，结构清晰，方便维护
      - 缺点：需要频繁地在核心态和用户态之间切换，性能低

## 中断
> 中断机制的产生
  - 引入中断机制，实现了多道程序并发执行
  - 本质：发生中断就意味着需要操作系统介入，开展管理工作
> 中断的概念和作用
  1. 当中断发生时，CPU立即进入核心态
  2. 当中断发生后，当前运行的进程暂停运行，并由操作系统内核对中断进行处理
  3. 对于不同的中断信号，会进行不同的处理
  - 发生了中断，就意味着需要操作系统介入，开展管理工作。由于操作系统的管理工作（比如进程切换、分配/O设备等）需要使用特权指令，因此CPU要从用户态转为核心态。中断可以使CPU从用户态切换为核心态，使操作系统获得计算机的控制权。有了中断，才能实现多道程序并发执行。
  - 中断时实现用户态&rarr;核心态的唯一途径
  - 核心态切换回用户态只需要一段指令
> 中断的分类
  - 内中断（CPU内部）
    - 自愿中断 — 指令中断
    - 强迫中断
      - 硬件故障（缺页）
      - 软件中断（整数除0）
  - 外中断（CPU外部，狭义中断）
    - 外设请求（如 I/O操作完成）
    - 人工干预（用户强制）
  - 内中断
    - 陷入，陷阱（唯一一个只能在用户态执行的指令）：有意而为之的异常
    - 故障：错误条件，可以修复
    - 终止：不可修复

## 系统调用
> 系统调用的作用
  - 应用程序通过系统调用请求操作系统的服务。系统中的各种共享资源都由操作系统统一掌管，因此在用户程序中，凡是与资源有关的操作(如存储分配、I/O操作、文件管理等)，都必须通过系统调用的方式向操作系统提出服务请求，由操作系统代为完成。这样可以保证系统的稳定性和安全性，防止用户进行非法操作。
> 系统调用与库函数
  - 系统调用需要在核心态处理
  - 操作系统：向上提供系统调用
  - 编程语言：向上提供库函数。有时会将系统调用封装成库函数
  - 应用程序：可直接进行系统调用，也可使用库函数。有的库函数涉及系统调用，有的不涉及
  - 传递系统调用参数执行陷入指令（用户态）&rarr; 执行系统调用相应服务程序（核心态）&rarr; 返回用户程序
  - 注意
    - 陷入指令是在用户态执行的，执行陷入指令之后立即引发一个内中断，从而CPU进入核心态
    - 发出系统调用请求是在用户态，而对系统调用的相应处理在核心态下进行
    - 陷入指令是唯一一个只能在用户态执行，而不可在核心态执行的指令